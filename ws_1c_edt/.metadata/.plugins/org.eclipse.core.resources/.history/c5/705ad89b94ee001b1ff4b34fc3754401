
&НаКлиенте
Асинх Процедура ДомашнийКаталогНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	Результат = Ждать Диалог.ВыбратьАсинх();
	
	//@skip-warning
	Если Результат.Количество() > 0 ТОгда
		НаборКонстант.ДомашнийКаталог = Результат[0];	
	КонецЕсли;
	
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если СокрЛП(НаборКонстант.АдресСервера) = "" Тогда
		НаборКонстант.АдресСервера = "0.0.0.0";
	КонецЕсли;
	
	Если НаборКонстант.ПортСервера = 0 Тогда
		НаборКонстант.ПортСервера = 8080;
	КонецЕсли;
	
	
КонецПроцедуры

&НаКлиенте
Процедура ПрочитатьНастройки(Команда)
	
	Если СокрЛП(НаборКонстант.ДомашнийКаталог) = "" Тогда
		ПредупреждениеАсинх("Не указан каталог файлов конфигурации!");
		Возврат;	
	КонецЕсли;
	
	Если НЕ КаталогСуществуетНаСервере("ДомашнийКаталог") Тогда
		ПредупреждениеАсинх("Каталог файлов не существует!");
		Возврат;
	КонецЕсли;

	ПрочитатьНаСервере();

КонецПроцедуры

&НаСервере
Функция КаталогСуществуетНаСервере(ИмяКонтанты)

	
	Файл = Новый Файл(НаборКонстант[ИмяКонтанты]);
	Возврат Файл.Существует();

КонецФункции

&НаСервере
Функция ЭтоЛинукс()
	
	Инф = Новый СистемнаяИнформация();
	Возврат Инф.ТипПлатформы = ТипПлатформы.Linux_x86_64;

КонецФункции

&НаСервере
Процедура ПрочитатьНаСервере()
	
	Файл = Новый Файл(НаборКонстант.КаталогФайловКофигурации + ?(НЕ ЭтоЛинукс(), "\", "/") + "config.json");
	
	Если Файл.Существует() Тогда
		
		Чтение = Новый ЧтениеJSON();
		
		Попытка
			Чтение.ОткрытьФайл(Файл.ПолноеИмя);
			Результат = СериализаторXDTO.ПрочитатьJSON(Чтение);
			НаборКонстант.АдресСервера = Результат.host;
			НаборКонстант.ПортСервера = Число(Результат.port);
			НаборКонстант.ДомашнийКаталог = Результат.dooc_root;
			Модифицированность = Истина;
		Исключение
			Сообщить("Ошибка открытия файла конфигурации!");
		КонецПопытки;
		
	КонецЕсли;
	

КонецПроцедуры


&НаКлиенте
Асинх Процедура КаталогФайловКофигурацииНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	Результат = Ждать Диалог.ВыбратьАсинх();
	
	//@skip-warning
	Если Результат.Количество() > 0 ТОгда
		НаборКонстант.КаталогФайловКофигурации = Результат[0];	
	КонецЕсли;
	
КонецПроцедуры



